<!-- Navbar with back button -->
<t-navbar wx:if="{{!minimized}}" title="{{navbarTitle}}" left-arrow delta="{{0}}" />
<view wx:if="{{!minimized}}" class="lb-call-back-hotarea" catchtap="onTapBack" />

<!-- Voice Call UI -->
<view wx:if="{{!minimized && mediaType === 'voice'}}" class="voice-call">
  <!-- Center: Avatar and info -->
  <view class="call-info">
    <image class="avatar-rect" src="/static/chat/avatar.png" mode="aspectFill" />
    <view class="peer-name">{{peerDisplayName || '通话'}}</view>
    <view class="call-status">{{statusText}}</view>
  </view>

  <!-- Bottom controls -->
  <view class="bottom-controls">
    <!-- Incoming call: Accept + Reject -->
    <t-button wx:if="{{showAccept}}" class="call-btn" theme="primary" shape="circle" icon="call" bind:tap="onTapAccept" />
    <t-button wx:if="{{showReject}}" class="call-btn call-btn-hangup" theme="danger" shape="circle" icon="call-off" bind:tap="onTapReject" />

    <!-- Outgoing call: Cancel -->
    <t-button wx:if="{{showCancel}}" class="call-btn call-btn-hangup" theme="danger" shape="circle" icon="call-off" bind:tap="onTapCancel" />

    <!-- In call: Mute + Hangup + Speaker -->
    <view wx:if="{{showHangup}}" class="call-action" catchtap="onToggleMute">
      <t-button class="call-btn" theme="default" shape="circle" icon="{{muted ? 'microphone-1' : 'microphone'}}" />
      <view class="call-action__label">{{muted ? '已静音' : '静音'}}</view>
    </view>
    <t-button wx:if="{{showHangup}}" class="call-btn call-btn-hangup" theme="danger" shape="circle" icon="call-off" bind:tap="onTapHangup" />
    <view wx:if="{{showHangup}}" class="call-action" catchtap="onToggleSpeaker">
      <t-button class="call-btn" theme="default" shape="circle" icon="{{speakerOn ? 'sound' : 'sound-mute'}}" />
      <view class="call-action__label">{{speakerOn ? '外放' : '听筒'}}</view>
    </view>
  </view>
</view>

<!-- Video Call UI -->
<view wx:if="{{!minimized && mediaType === 'video'}}" class="video-call" catchtap="onTapScreen">
  <!-- Remote video (full screen) -->
  <canvas type="2d" id="remoteVideo" class="remote-video"></canvas>

  <!-- Local preview (top right) -->
  <camera class="local-preview" device-position="front" flash="off" binderror="onCameraError"></camera>

  <!-- Status text (top left) -->
  <view class="status-text">{{statusText}}</view>

  <!-- Top controls (can hide) -->
  <view wx:if="{{controlsVisible}}" class="top-controls">
    <view class="control-btn" catchtap="onToggleMute">
      <t-icon name="{{muted ? 'microphone-1' : 'microphone'}}" size="48rpx" color="#fff" />
    </view>
    <view class="control-btn" catchtap="onSwitchCamera">
      <t-icon name="camera-rotate" size="48rpx" color="#fff" />
    </view>
  </view>

  <!-- Bottom controls (can hide) -->
  <view wx:if="{{controlsVisible}}" class="bottom-controls">
    <view wx:if="{{showAccept}}" class="control-btn" catchtap="onTapAccept">
      <t-icon name="video" size="56rpx" color="#fff" />
    </view>
    <view wx:if="{{showReject}}" class="control-btn hangup" catchtap="onTapReject">
      <t-icon name="call-off" size="56rpx" color="#fff" />
    </view>
    <view wx:if="{{showCancel}}" class="control-btn hangup" catchtap="onTapCancel">
      <t-icon name="call-off" size="56rpx" color="#fff" />
    </view>
    <view wx:if="{{showHangup}}" class="control-btn" catchtap="onShowMenu">
      <t-icon name="menu" size="56rpx" color="#fff" />
    </view>
    <view wx:if="{{showHangup}}" class="control-btn" catchtap="onToggleMute">
      <t-icon name="{{muted ? 'microphone-1' : 'microphone'}}" size="56rpx" color="#fff" />
    </view>
    <view wx:if="{{showHangup}}" class="control-btn" catchtap="onToggleSpeaker">
      <t-icon name="{{speakerOn ? 'sound' : 'sound-mute'}}" size="56rpx" color="#fff" />
    </view>
    <view wx:if="{{showHangup}}" class="control-btn hangup" catchtap="onTapHangup">
      <t-icon name="call-off" size="56rpx" color="#fff" />
    </view>
  </view>
</view>

<!-- Floating window -->
<movable-area wx:if="{{minimized}}" class="floating-area">
  <movable-view class="floating-window" direction="all" inertia>
    <view class="floating-content" catchtap="onRestoreFromFloating">
      <t-icon name="{{mediaType === 'video' ? 'video' : 'call'}}" size="56rpx" color="#07c160" />
      <view class="floating-status">{{statusText}}</view>
    </view>
  </movable-view>
</movable-area>
